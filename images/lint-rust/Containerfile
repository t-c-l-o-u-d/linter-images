# GNU Affero General Public License v3.0 or later (see COPYING or https://www.gnu.org/licenses/agpl.txt)

FROM ghcr.io/t-c-l-o-u-d/linter-images/base-linter:latest

# install rust toolchain and linter packages
RUN pacman --sync --refresh --noconfirm \
    cargo-audit \
    cargo-deny \
    gcc \
    pkgconf \
    rust

# clean up pacman cache
RUN pacman --sync --clean --clean --noconfirm

# redirect build artifacts out of the (read-only) workspace
ENV CARGO_TARGET_DIR=/tmp/target
ENV LINTER_IMAGE=lint-rust

COPY lint.bash /usr/local/bin/lint
COPY fix.bash /usr/local/bin/fix
RUN chmod +x /usr/local/bin/lint /usr/local/bin/fix

WORKDIR /workspace

LABEL org.opencontainers.image.authors "https://github.com/t-c-l-o-u-d"
LABEL org.opencontainers.image.description "Linter image for rust: clippy, rustfmt, cargo-audit, cargo-deny"
LABEL org.opencontainers.image.licenses "AGPL-3.0-or-later"
LABEL org.opencontainers.image.source "https://github.com/t-c-l-o-u-d/linter-images"
